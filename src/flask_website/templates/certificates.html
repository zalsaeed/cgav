<!-- certificates.html -->

{% extends 'base.html' %}

{% block title %}Certificates{% endblock %}

{% block body %}
  <div class="container mt-5">
    <h1 class="mb-4 text-center">Your Events</h1>

    <h2 class="mt-5 mb-4 text-center" id="certificates-title">Latest Certificates</h2>
    <div class="row">
      <!-- Display the latest 3 certificates -->
      {% for certificate in latest_certificates %}
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">{{ certificate.certificate_title }}</h5>
              <p class="card-text">Presenter: {{ certificate.presenter_name }}</p>
              <p class="card-text">Event Date: {{ certificate.event_date.strftime('%Y-%m-%d') }}</p>
              <a href="/certificate_details/{{ certificate.certificate_event_id }}" class="custom-button">More Info</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div id="all-certificates" class="row">
      <!-- AJAX will populate this section -->
    </div>

    <div class="text-center mt-3">
      <button id="load-certificates-btn" class="custom-button">Load All Certificates</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const allCertificatesContainer = document.getElementById('all-certificates');
      const certificatesTitle = document.getElementById('certificates-title');
      const loadCertificatesBtn = document.getElementById('load-certificates-btn');

      loadCertificatesBtn.addEventListener('click', function () {
        // Toggle between "Latest Certificates" and "All Certificates"
        const isLatest = certificatesTitle.textContent === 'Latest Certificates';
        certificatesTitle.textContent = isLatest ? 'All Certificates' : 'Latest Certificates';

        // Toggle between "Load All Certificates" and "Back"
        loadCertificatesBtn.textContent = isLatest ? 'Back' : 'Load All Certificates';

        if (isLatest) {
          // Make an AJAX request to load all certificates
          fetch('/load_all_certificates')
            .then(response => response.json())
            .then(certificates => {
              // Update the UI with the received certificates
              allCertificatesContainer.innerHTML = ''; // Clear existing certificates

              certificates.forEach(certificate => {
                const certificateCard = document.createElement('div');
                certificateCard.classList.add('col-md-4', 'mb-4');
                certificateCard.innerHTML = `
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">${certificate.certificate_title}</h5>
                      <p class="card-text">Presenter: ${certificate.presenter_name}</p>
                      <p class="card-text">Date: ${new Date(certificate.event_date).toLocaleDateString('en-US')}</p>
                      <a href="/certificate_details/${certificate.certificate_event_id}" class="custom-button">More Info</a>
                    </div>
                  </div>
                `;
                allCertificatesContainer.appendChild(certificateCard);
              });
            })
            .catch(error => console.error('Error loading certificates:', error));
        } else {
          // Implement the logic to load the latest certificates or reload the page
          // ...

          // Example: Reloading the page
          location.reload();
        }
      });
    });
  </script>
{% endblock %}
